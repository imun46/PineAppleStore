<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwill.shop.mapper.CartMapper">

<insert id="insert" parameterType="Cart">
	INSERT INTO cart 
	VALUES(cart_cart_no_seq.nextval, #{cartQty}, #{customerNo})
</insert>

<select id="countByProductNo" parameterType="int" resultType="int">
	SELECT count(*) as count 
	FROM cart c
	JOIN product_selected ps
	ON c.cart_no = ps.cart_no
	WHERE ps.product_no = #{productNo};
</select>

<update id="updateByproductSelected">
	UPDATE product_selected ps
	SET ps.product_option_detail_no = #{productOptionDetailNo}
	WHERE ps.product_option_detail_no IN (
    SELECT pd.product_option_detail_no
    FROM product_option_detail pd
    JOIN product_option po
    ON pd.product_option_no = po.product_option_no
    WHERE po.product_no = #{productNo}
    AND po.product_option_no = {productOptionNo}
)
</update>

<update id="update" parameterType="Cart">
	UPDATE cart
	SET cart_qty = cart_qty + #{cartQty}
	WHERE cart_no = #{cartNo}
</update>

<delete id="deleteByCartNo" parameterType="int">
	DELETE FROM cart
	WHERE cart_no = #{cartNo}
</delete>

<delete id="deleteByCustomerNo" parameterType="int">
	DELETE FROM cart
	WHERE customer_no = #{customerNo}
</delete>

<select id="findAll">
	SELECT * FROM cart
</select>

<select id="findByCustomerNo" parameterType="int">
	SELECT * FROM cart WHERE customerNo=#{customerNo}
</select>

</mapper>