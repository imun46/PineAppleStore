<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwill.shop.mapper.OrdersMapper">
	<resultMap id="orderResultMap" type="Orders" autoMapping="true">
		<id column="orders_no" property="ordersNo"/>
		
		<association property="customer" autoMapping="true" javaType="Customer">
			<id column="customer_no" property="customerNo"/>
		</association>
		
		<association property="customerCoupons" autoMapping="true" javaType="CustomerCoupons">
			<id column="customer_coupons_no" property="customerCouponsNo"/>
		</association>
		
		<collection property="orderItems" autoMapping="true" ofType="OrdersItems">
			<id column="orderItems_no" property="orderItemsNo"/>
			<association property="orders" javaType="Orders" autoMapping="true">
				<id column="ordersItems_no" property="ordersItemsNo"/>			
			</association>
			<association property="product" javaType="Product" autoMapping="true">
				<id column="product_no" property="productNo"/>			
			</association>
		</collection>
		
	</resultMap>
	
<<<<<<< Upstream, based on origin/Ateam/기현
	
<<<<<<< Upstream, based on origin/Ateam/기현
<<<<<<< Upstream, based on origin/Ateam/기현
=======
	<insert id="insert">
=======
=======
	<!-- 주문 등록 -->
>>>>>>> b972a88 orders 주석 수정
	<insert id="insertOrder" parameterType="Orders">
		<selectKey order="BEFORE" resultType="int" keyProperty="ordersNo">
			select orders_orders_no_seq.nextval from dual
		</selectKey>
		insert into orders(Orders_No, Orders_Date, Orders_Arrivaldate, Orders_Totprice, Orders_Finalprice, Orders_Totqty, Orders_Address, Orders_Status, Customer_No, Customer_Coupons_No) 
		values (#{ordersNo}, sysdate, null, #{ordersTotprice}, #{ordersFinalprice}, #{ordersTotqty}, #{ordersAddress}, #{ordersStatus}, #{customer.customerNo}, 
            #{customerCoupons.customerCouponsNo})
>>>>>>> 02c44db orders insert 완성
	</insert>
<<<<<<< Upstream, based on origin/Ateam/기현
<<<<<<< Upstream, based on origin/Ateam/기현
>>>>>>> 720e04b orderMapper 수정중
=======
=======
	
<<<<<<< Upstream, based on origin/Ateam/기현
>>>>>>> 5ede523 orders select 완성 , service 구현 완료
=======
	<!-- 주문아이템 등록 -->
>>>>>>> b972a88 orders 주석 수정
	<insert id="insertOrderItem" parameterType="OrdersItems">
		<selectKey order="BEFORE" resultType="int" keyProperty="ordersItemsNo">
			select orders_items_orders_items_no_seq.nextval from dual 
		</selectKey>
		 insert into orders_items (orders_items_no, orders_items_price,orders_items_finalprice, orders_items_qty, orders_items_options, orders_no, product_no) 
		 values (#{ordersItemsNo}, #{ordersItemsprice}, #{ordersItemsFinalprice}, #{ordersItemsQty}, #{ordersItemsOptions},orders_orders_no_seq.currval, #{product.productNo})
	</insert>
	
	<!-- 주문 전체 리스트(어드민) -->
	<select id="selectAll" resultMap="orderResultMap">
		select orders_no, orders_date, orders_arrivaldate,orders_totprice, orders_finalprice,orders_totqty, orders_address,orders_status,customer_no, customer_coupons_no
		from orders
	</select>
	
	<!-- 주문+주문아이템 리스트(특정회원) -->
	<select id="selectByOrderNo" parameterType="int" resultMap="orderResultMap">
		select o.orders_no, o.orders_date,o.orders_finalprice,o.orders_status, 
			   oi.orders_items_no,oi.orders_items_price,oi.orders_items_finalprice,oi.orders_items_qty,oi.orders_items_options,oi.product_no
		from orders o
		join orders_items oi
		on o.orders_no = oi.orders_no
		where o.orders_no = #{ordersNo}
	</select>

	<!-- 주문 1건 삭제 -->
	<delete id="delete" parameterType="int">
		delete from orders where orders_no = #{ordersNo}
	</delete>
>>>>>>> 02c44db orders insert 완성
</mapper>